version: '3.8'

# ==========================================
# 🔧 Docker Compose para DESARROLLO
# ==========================================

services:
  # ==========================================
  # 📊 Analytics API - Configuración Dev
  # ==========================================
  analytics-api:
    build:
      context: ./PharmaVida-analitica
      dockerfile: Dockerfile
    command: python main.py
    environment:
      - FLASK_ENV=development
      - FLASK_DEBUG=1
      - PYTHONUNBUFFERED=1
    volumes:
      - ./PharmaVida-analitica:/app:delegated
      - /app/.venv
    networks:
      - pharmavida-network

  # ==========================================
  # 🎯 Orquestador API - Configuración Dev
  # ==========================================
  orquestador-api:
    build:
      context: ./orquestador_backend
      dockerfile: Dockerfile
    command: python manage.py runserver 0.0.0.0:8888
    environment:
      - DJANGO_DEBUG=True
      - PYTHONUNBUFFERED=1
      - DJANGO_SETTINGS_MODULE=config.settings
    volumes:
      - ./orquestador_backend:/app:delegated
      - /app/.venv
    networks:
      - pharmavida-network

  # ==========================================
  # 👥 Usuarios API - Configuración Dev
  # ==========================================
  usuarios-api:
    build:
      context: ./farmacy
      dockerfile: Dockerfile
    environment:
      - SPRING_PROFILES_ACTIVE=dev
      - LOGGING_LEVEL_ROOT=DEBUG
    networks:
      - pharmavida-network

  # ==========================================
  # 🏪 Productos API - Configuración Dev
  # ==========================================
  productos-api:
    build:
      context: ./pharmacy-products
      dockerfile: Dockerfile
    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload --log-level debug
    environment:
      - ENVIRONMENT=development
      - PYTHONUNBUFFERED=1
    volumes:
      - ./pharmacy-products:/app:delegated
      - /app/.venv
    networks:
      - pharmavida-network

  # ==========================================
  # 📝 Recetas API - Configuración Dev
  # ==========================================
  recetas-api:
    build:
      context: ./recetas_cloud
      dockerfile: Dockerfile
    command: node --inspect=0.0.0.0:9229 src/app.js
    environment:
      - NODE_ENV=development
      - DEBUG=*
    ports:
      - "9229:9229"
    volumes:
      - ./recetas_cloud/src:/usr/src/app/src:delegated
      - /usr/src/app/node_modules
    networks:
      - pharmavida-network

networks:
  pharmavida-network:
    driver: bridge
    name: pharmavida-network
